---
import { getVotesPerCombat } from '@/lib/db/vote-repository';
import { getAllCombatWinners } from '@/lib/db/winner-repository';
import { getUserFromRequest } from '@/lib/session';
import { getVotesByUser } from '@/lib/voting';
import { CombatsDisplay } from '../components/combats';
import Layout from '../layouts/Layout.astro';

const user = await getUserFromRequest(Astro.request);
const isAdmin = user?.isAdmin || false;

const winners = await getAllCombatWinners();
const userVotes = user ? await getVotesByUser(user.id) : [];
const votesPerCombat = await getVotesPerCombat();
---

<Layout title="Combates - La Apuestada">
  <main
    class="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 py-8"
  >
    <div class="container mx-auto px-4 py-8">
      <div class="text-center mb-8">
        <div
          class="bg-white/10 backdrop-blur-md rounded-2xl shadow-2xl border border-white/20 p-8 mb-8"
        >
          <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">
            ðŸ¥Š Resultados Ã‰picos
          </h1>
          <p class="text-xl text-gray-200 max-w-2xl mx-auto">
            Â¡Bienvenido a la arena donde los puÃ±etazos vuelan y los egos se
            rompen!<br />
            AquÃ­ los luchadores se juegan la dignidad... vosotros solo un par de
            eurillos y el orgullo. <br />
            Consulta los resultados, presume de tus aciertos o Ã©chale la culpa a
            los jueces si no acertaste.
          </p>
        </div>
      </div>

      <CombatsDisplay
        client:load
        adminMode={isAdmin}
        winners={winners}
        userVotes={userVotes}
        votesPerCombat={votesPerCombat}
      />
    </div>
  </main>
</Layout>

<style>
  .container {
    max-width: 1200px;
  }
</style>
